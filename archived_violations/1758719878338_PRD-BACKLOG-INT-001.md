# PRD: Backlog Data Integration and Application Isolation Framework

**PRD ID:** PRD-BACKLOG-INT-001
**Strategic Directive:** SD-BACKLOG-INT-001
**Target Application:** EHG_ENGINEER
**Priority:** CRITICAL
**Status:** Draft

## 1. Executive Summary

This PRD defines the technical implementation for integrating the imported backlog data (sd_backlog_map and strategic_directives_backlog tables) into the LEO Protocol workflow, while establishing strict application boundaries between EHG and EHG_Engineer to prevent cross-contamination.

## 2. Problem Statement

### Current State
- Rich backlog data exists in database but is disconnected from LEO Protocol
- No enforcement of application boundaries (EHG vs EHG_Engineer)
- PLAN agents don't have instructions to use backlog data
- Risk of implementing features in wrong application

### Desired State
- Full integration of backlog data into PRD generation
- Automatic application boundary validation
- Clear documentation in CLAUDE.md
- Zero cross-application implementation errors

## 3. Technical Architecture

### 3.1 Database Layer

#### Application-Specific Views
```sql
-- View for EHG_ENGINEER backlog items
CREATE OR REPLACE VIEW v_ehg_engineer_backlog AS
SELECT
  b.*,
  sd.target_application,
  sd.title as sd_title,
  sd.priority as sd_priority
FROM sd_backlog_map b
JOIN strategic_directives_v2 sd ON b.sd_id = sd.id
WHERE sd.target_application = 'EHG_ENGINEER';

-- View for EHG backlog items
CREATE OR REPLACE VIEW v_ehg_backlog AS
SELECT
  b.*,
  sd.target_application,
  sd.title as sd_title,
  sd.priority as sd_priority
FROM sd_backlog_map b
JOIN strategic_directives_v2 sd ON b.sd_id = sd.id
WHERE sd.target_application = 'EHG' OR sd.target_application IS NULL;

-- Validation view for cross-references
CREATE OR REPLACE VIEW v_backlog_validation AS
SELECT
  sd.id as sd_id,
  sd.target_application,
  COUNT(b.backlog_id) as total_items,
  COUNT(CASE WHEN b.item_description LIKE '%EHG_Engineer%' THEN 1 END) as engineer_mentions,
  COUNT(CASE WHEN b.item_description LIKE '%EHG %' THEN 1 END) as ehg_mentions
FROM strategic_directives_v2 sd
LEFT JOIN sd_backlog_map b ON sd.id = b.sd_id
GROUP BY sd.id, sd.target_application;
```

### 3.2 Application Layer

#### Enhanced PRD Generation
- Query sd_backlog_map for detailed requirements
- Auto-generate acceptance criteria from item_description
- Include backlog priorities in technical requirements
- Add traceability matrix

#### Validation Service
```javascript
class ApplicationBoundaryValidator {
  async validateSD(sdId) {
    // Check target_application
    // Verify backlog items match target
    // Return validation result with warnings/errors
  }

  async validateImplementation(sdId, targetPath) {
    // Check if implementation path matches target_application
    // Block if mismatch detected
  }
}
```

### 3.3 Documentation Layer

#### CLAUDE.md Updates
- Add "Backlog Integration" section
- Document table structure and relationships
- Provide query examples for agents
- Include validation requirements

## 4. Functional Requirements

### 4.1 Backlog Integration
- **FR-001**: PLAN agent MUST query sd_backlog_map when creating PRDs
- **FR-002**: PRD generation MUST include backlog item descriptions
- **FR-003**: System MUST generate acceptance criteria from backlog data
- **FR-004**: Dashboard MUST display backlog context for each SD

### 4.2 Application Isolation
- **FR-005**: All SDs MUST have target_application specified
- **FR-006**: System MUST validate target_application before implementation
- **FR-007**: Cross-application violations MUST be blocked with error
- **FR-008**: System MUST provide override mechanism with audit trail

### 4.3 Documentation
- **FR-009**: CLAUDE.md MUST include backlog integration instructions
- **FR-010**: System MUST provide backlog utilization reports
- **FR-011**: Handoffs MUST include backlog summary

## 5. Non-Functional Requirements

- **Performance**: Backlog queries < 100ms
- **Scalability**: Support 10,000+ backlog items
- **Reliability**: 99.9% uptime for validation service
- **Security**: Audit all boundary violations
- **Usability**: Clear error messages for violations

## 6. Acceptance Criteria

### AC-1: Database Views Created
- [ ] v_ehg_engineer_backlog view exists and returns correct data
- [ ] v_ehg_backlog view exists and returns correct data
- [ ] v_backlog_validation view provides accurate counts

### AC-2: PRD Generation Enhanced
- [ ] generate-prd-from-sd.js queries backlog data
- [ ] PRDs include backlog item descriptions
- [ ] Acceptance criteria auto-generated from items

### AC-3: Validation Working
- [ ] ApplicationBoundaryValidator blocks cross-app implementations
- [ ] Clear error messages displayed
- [ ] Audit trail created for violations

### AC-4: Documentation Complete
- [ ] CLAUDE.md updated with backlog instructions
- [ ] Query examples provided
- [ ] LEO Protocol references backlog tables

### AC-5: Dashboard Integration
- [ ] Backlog counts visible on SD cards
- [ ] Filter by target_application works
- [ ] Backlog details accessible from UI

## 7. Implementation Plan

### Phase 1: Database Layer (Day 1)
- Create application-specific views
- Add validation views
- Test queries

### Phase 2: PRD Enhancement (Day 2)
- Update generate-prd-from-sd.js
- Add backlog query logic
- Generate acceptance criteria

### Phase 3: Validation Service (Day 3)
- Implement ApplicationBoundaryValidator
- Add to unified-handoff-system.js
- Test boundary enforcement

### Phase 4: Documentation (Day 4)
- Update CLAUDE.md
- Create usage examples
- Document in retrospective

### Phase 5: Dashboard Integration (Day 5)
- Update UI components
- Add backlog displays
- Test filters

## 8. Risks & Mitigations

| Risk | Impact | Mitigation |
|------|--------|------------|
| Existing SDs lack target_application | High | Backfill script based on analysis |
| Performance impact of joins | Medium | Add indexes on foreign keys |
| Resistance to validation blocks | Low | Provide clear override process |

## 9. Success Metrics

- Zero cross-application implementation errors (post-implementation)
- 100% of new PRDs reference backlog data
- 50% reduction in requirement clarification requests
- All SDs have target_application within 30 days

## 10. Dependencies

- sd_backlog_map table (exists)
- strategic_directives_backlog table (exists)
- strategic_directives_v2.target_application column (exists)

---

**Approval Status:** Pending LEAD Review
**Created By:** PLAN Agent
**Date:** 2025-09-24
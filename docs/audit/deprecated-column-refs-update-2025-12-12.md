# Deprecated Column References Update - 2025-12-12


## Metadata
- **Category**: Guide
- **Status**: Draft
- **Version**: 1.0.0
- **Author**: DOCMON
- **Last Updated**: 2025-12-22
- **Tags**: database, schema, feature, protocol

## Summary

Updated 3 out of 4 `leo_protocol_sections` table records to replace deprecated SD ID schema patterns with the new standardized approach.

## Context

**Strategic Directive**: SD ID Schema Cleanup
**Date**: 2025-12-12
**Purpose**: Align documentation with database schema changes that standardized on `strategic_directives_v2.id` as the canonical identifier

## Database Schema Changes (Implemented Previously)

- **Old Pattern**: `strategic_directives_v2.uuid_id` (UUID, deprecated)
- **New Pattern**: `strategic_directives_v2.id` (VARCHAR, canonical)
- **FK Updates**: `product_requirements_v2.sd_id` now references `strategic_directives_v2.id`
- **Table Rename**: `prds` â†’ `product_requirements_v2`

## Sections Updated

### Section 269: "ðŸ“š Automated PRD Enrichment (MANDATORY)"
**Type**: knowledge_retrieval
**Changes**:
- Replaced 4 occurrences of `<SD_UUID>` â†’ `<SD_ID>` in CLI examples

**Examples**:
```bash
# Before:
node scripts/phase-preflight.js --phase PLAN --sd-id <SD_UUID>
node scripts/enrich-prd-with-research.js <SD_UUID>

# After:
node scripts/phase-preflight.js --phase PLAN --sd-id <SD_ID>
node scripts/enrich-prd-with-research.js <SD_ID>
```

### Section 311: "AI-Powered Russian Judge Quality Assessment"
**Type**: ai_quality_russian_judge
**Changes**:
- 1 occurrence: `strategic_directives_v2.uuid_id` â†’ `strategic_directives_v2.id`
- 2 occurrences: `sd_uuid` â†’ `sd_id`
- 1 occurrence: `prds` â†’ `product_requirements_v2`

**Examples**:
```
# Before:
- PRD validation: Fetches SD via `prd.sd_uuid â†’ strategic_directives_v2.uuid_id`
- User Story validation: Fetches PRD via `user_story.prd_id â†’ prds.id`

# After:
- PRD validation: Fetches SD via `prd.sd_id â†’ strategic_directives_v2.id`
- User Story validation: Fetches PRD via `user_story.prd_id â†’ product_requirements_v2.id`
```

### Section 312: "Quality Assessment Integration in Handoffs"
**Type**: handoff_quality_gates
**Changes**:
- 3 occurrences: `sd_uuid` â†’ `sd_id`
- 2 occurrences: `prds` â†’ `product_requirements_v2`

**Examples**:
```
# Before:
- `sd_uuid`: Foreign key to parent Strategic Directive
- `prds`: Product Requirements Documents

# After:
- `sd_id`: Foreign key to parent Strategic Directive
- `product_requirements_v2`: Product Requirements Documents
```

### Section 295: "Parent-Child SD Phase Governance"
**Status**: No changes needed (already using correct patterns)

## Replacement Patterns Applied

The following regex patterns were used for automated replacement:

1. `strategic_directives_v2\.uuid_id` â†’ `strategic_directives_v2.id`
2. `--sd-uuid` â†’ `--sd-id` (CLI flags)
3. `<SD_UUID>` â†’ `<SD_ID>` (documentation placeholders)
4. `${SD_UUID}` â†’ `${SD_ID}` (template variables)
5. `\bsd_uuid\b` â†’ `sd_id` (column references)
6. `\bprds\b` â†’ `product_requirements_v2` (table names)

## Verification

### Updated Content Verified
- Section 269: CLI examples now use `<SD_ID>` placeholder
- Section 311: Foreign key references updated to new schema
- Section 312: Database schema documentation updated

### No Deprecated Patterns Remain
All references to deprecated patterns have been replaced in the updated sections.

## Impact Assessment

### Systems Affected
- LEO Protocol documentation (3 sections)
- PRD enrichment workflow documentation
- Quality assessment documentation
- Handoff quality gates documentation

### Systems NOT Affected
- Database schema (changes already implemented)
- Application code (separate update process)
- CLI scripts (separate update process)

## Next Steps

1. **Regenerate CLAUDE.md**: Run `node scripts/generate-claude-md-from-db.js` to pull updated sections into context files
2. **Review remaining files**: Search for deprecated patterns in:
   - Other `leo_protocol_sections` records
   - Documentation files in `/docs`
   - Script files in `/scripts`
3. **Update application code**: Ensure all scripts using old patterns are updated

## Tools Created

### /mnt/c/_EHG/EHG_Engineer/scripts/update-deprecated-column-refs.js
- **Purpose**: Automated replacement of deprecated column references
- **Features**:
  - Pattern-based text replacement
  - Multi-section batch updates
  - Change logging and verification
  - Error handling for failed updates

### /mnt/c/_EHG/EHG_Engineer/scripts/verify-column-updates.js
- **Purpose**: Verify updates were applied correctly
- **Features**:
  - Fetches updated sections
  - Displays relevant changed lines
  - Confirms new patterns in place

## Success Metrics

- **Sections Processed**: 4
- **Sections Updated**: 3
- **Total Replacement Types**: 6 unique patterns
- **Success Rate**: 100% (all targeted patterns replaced)
- **Content Integrity**: Verified (no corruption, proper formatting maintained)

## Generated By

- **Script**: `/mnt/c/_EHG/EHG_Engineer/scripts/update-deprecated-column-refs.js`
- **Date**: 2025-12-12
- **Operator**: Database Agent (Claude Sonnet 4.5)
- **SD Context**: SD-VISION-TRANSITION-001D6 (Phase 6)
